name: Generate Pacman Animation

on:
  schedule:
    - cron: "0 */12 * * *"
  workflow_dispatch:
  push:
    branches: [ main ]

jobs:
  generate:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Generate Pacman SVGs
        run: |
          # Создаем директорию для SVG
          mkdir -p generated
          
          # Основной SVG (светлая тема)
          cat > generated/pacman-contribution-graph.svg << 'EOF'
          <svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100">
            <style>
              .pacman {
                animation: eat 0.7s infinite;
                transform-origin: center;
                fill: #FFD700;
              }
              @keyframes eat {
                0% { transform: rotate(0deg); }
                50% { transform: rotate(-45deg); }
                100% { transform: rotate(0deg); }
              }
            </style>
            <circle cx="50" cy="50" r="40" class="pacman"/>
          </svg>
          EOF
          
          # Темная тема
          sed 's/#FFD700/#FF8C00/' generated/pacman-contribution-graph.svg > generated/pacman-contribution-graph-dark.svg
          
          # Проверяем создание файлов
          ls -la generated/

      - name: Push to output branch
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          
          # Создаем/переключаемся на ветку output
          git checkout --orphan output 2>/dev/null || git checkout output
          
          # Очищаем ветку (если она уже существовала)
          git rm -rf . 2>/dev/null || true
          
          # Копируем SVG из директории generated
          cp -v generated/*.svg ./
          
          # Фиксируем изменения
          git add .
          git commit -m "Update Pacman SVGs [$(date +%Y-%m-%d)]"
          git push origin output --force
