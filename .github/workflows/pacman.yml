name: Generate Pacman Animation

on:
  schedule:
    - cron: "0 */12 * * *"
  workflow_dispatch:
  push:
    branches: [ main ]

jobs:
  generate:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Generate Pacman SVG
        run: |
          # Создаем SVG с анимацией
          cat << 'EOF' > pacman.svg
          <svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100">
            <style>
              .pacman {
                animation: eat 0.7s infinite;
                transform-origin: center;
                fill: #FFD700;
              }
              @keyframes eat {
                0% { transform: rotate(0deg); }
                50% { transform: rotate(-45deg); }
                100% { transform: rotate(0deg); }
              }
            </style>
            <circle cx="50" cy="50" r="40" class="pacman"/>
          </svg>
          EOF
          
          # Создаем темную версию
          sed 's/#FFD700/#FF8C00/' pacman.svg > pacman-dark.svg
          
          # Переименовываем по стандарту
          mv pacman.svg pacman-contribution-graph.svg
          mv pacman-dark.svg pacman-contribution-graph-dark.svg
          
          # Проверяем что файлы созданы
          ls -la *.svg

      - name: Setup output branch
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          
          # Создаем или переключаемся на ветку output
          git checkout --orphan output || git checkout output
          git reset --hard
          
          # Копируем файлы
          cp ../*.svg ./
          
          # Фиксируем изменения
          git add .
          git commit -m "Update Pacman SVGs"
          git push origin output --force
